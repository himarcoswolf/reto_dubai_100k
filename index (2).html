<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Reto Dubai 100K - Live Tracking</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.4); } 50% { box-shadow: 0 0 40px rgba(6, 182, 212, 0.8); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bob { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-slide-in { animation: slideIn 0.5s ease-out; }
        .animate-bob { animation: bob 2s ease-in-out infinite; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); }
        ::-webkit-scrollbar-thumb { background: rgba(6, 182, 212, 0.5); border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const firebaseConfig = {
            apiKey: "AIzaSyB5KzKadpKslPn6cJrZUAxZ3gXTF_GWazE",
            authDomain: "reto-dubai-100k-10k.firebaseapp.com",
            databaseURL: "https://reto-dubai-100k-10k-default-rtdb.firebaseio.com",
            projectId: "reto-dubai-100k-10k",
            storageBucket: "reto-dubai-100k-10k.firebasestorage.app",
            messagingSenderId: "460196197011",
            appId: "1:460196197011:web:aae62f87d6352351e41366"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        const START_DATE = new Date('2025-11-01T00:00:00+04:00');
        const GOAL = 100000;
        const INITIAL_BUDGET = 10000;
        const ADMIN_PASSWORD = 'Dubai2025!';
        
        const LOCATIONS = {
            oficina: { id: 'oficina', name: 'üè¢ Oficina', icon: 'üè¢', color: 'from-blue-500 to-cyan-500', defaultActivity: 'Trabajando' },
            gimnasio: { id: 'gimnasio', name: 'üí™ Gimnasio', icon: 'üí™', color: 'from-orange-500 to-red-500', defaultActivity: 'Entrenamiento' },
            casa: { id: 'casa', name: 'üè† Casa', icon: 'üè†', color: 'from-purple-500 to-pink-500', defaultActivity: 'Descansando' },
            reunion: { id: 'reunion', name: 'ü§ù Reuni√≥n', icon: 'ü§ù', color: 'from-green-500 to-emerald-500', defaultActivity: 'Reuni√≥n con cliente' },
            mall: { id: 'mall', name: 'üèôÔ∏è Dubai Mall', icon: 'üèôÔ∏è', color: 'from-yellow-500 to-orange-500', defaultActivity: 'Networking' },
            aeropuerto: { id: 'aeropuerto', name: '‚úàÔ∏è Aeropuerto', icon: '‚úàÔ∏è', color: 'from-sky-500 to-blue-500', defaultActivity: 'Viajando' },
            restaurante: { id: 'restaurante', name: 'üçΩÔ∏è Restaurante', icon: 'üçΩÔ∏è', color: 'from-amber-500 to-orange-500', defaultActivity: 'Comida' }
        };
        
        console.log('‚úÖ Firebase inicializado correctamente');
        
        const App = () => {
            const [data, setData] = useState({
                totalIngresos: 0, totalGastos: 0,
                ingresosPorCategoria: { asesoria: 0, realEstate: 0, inversiones: 0 },
                actualizaciones: [], mensajes: [],
                currentLocation: 'casa', currentActivity: 'Iniciando el d√≠a',
                locationChangedAt: new Date().toISOString(), isAutoSleeping: false
            });
            const [visitantes, setVisitantes] = useState(0);
            const [showAdmin, setShowAdmin] = useState(false);
            const [isAuth, setIsAuth] = useState(false);
            const [pass, setPass] = useState('');
            const [showLogros, setShowLogros] = useState(false);
            const [newMsg, setNewMsg] = useState('');
            const [editing, setEditing] = useState(null);
            const [actForm, setActForm] = useState({ location: 'oficina', activity: '' });
            const [finForm, setFinForm] = useState({ categoria: 'asesoria', monto: '', tipo: 'ingreso', nota: '' });
            
            useEffect(() => {
                const ref = database.ref('retoData');
                ref.on('value', snap => { const d = snap.val(); if(d) setData(d); });
                const vRef = database.ref('visitantes');
                vRef.transaction(c => (c||0) + 1);
                vRef.on('value', s => setVisitantes(s.val()||0));
                return () => { ref.off(); vRef.off(); };
            }, []);
            
            const update = u => database.ref('retoData').set({...data, ...u});
            const logros = [];
            if(data.totalIngresos >= 25000) logros.push('25k');
            if(data.totalIngresos >= 50000) logros.push('50k');
            if(data.totalIngresos >= 75000) logros.push('75k');
            
            const prog = (data.totalIngresos / GOAL) * 100;
            const budget = INITIAL_BUDGET - data.totalGastos;
            const progBudget = (budget / INITIAL_BUDGET) * 100;
            
            const getTime = () => {
                const d = Math.floor((new Date() - new Date(data.locationChangedAt)) / 60000);
                const h = Math.floor(d / 60), m = d % 60;
                return h > 0 ? `${h}h ${m}m` : `${m}m`;
            };
            
            const getDays = () => Math.floor((new Date() - START_DATE) / 86400000);
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white">
                    <div className="bg-black/50 backdrop-blur-md border-b border-cyan-500/30 p-4 sticky top-0 z-50">
                        <div className="max-w-6xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold bg-gradient-to-r from-cyan-400 to-orange-500 bg-clip-text text-transparent">‚ö° RETO DUBAI 100K</h1>
                                <p className="text-xs text-cyan-400/70">üî• Tiempo real con Firebase</p>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-right"><div className="text-xs text-gray-400">D√≠a #{getDays()}</div><div className="text-xs text-orange-400">üëÅÔ∏è {visitantes}</div></div>
                                <button onClick={() => setShowAdmin(!showAdmin)} className="text-2xl">üîí</button>
                            </div>
                        </div>
                    </div>
                    
                    <div className="max-w-6xl mx-auto px-4 py-6">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div className="bg-cyan-500/10 border border-cyan-500/30 rounded-lg p-4 text-center">
                                <div className="text-sm text-cyan-400">üí∞ Ganado</div>
                                <div className="text-2xl font-bold text-cyan-400">{data.totalIngresos.toLocaleString()}‚Ç¨</div>
                                <div className="text-xs text-gray-400">{prog.toFixed(1)}%</div>
                            </div>
                            <div className="bg-orange-500/10 border border-orange-500/30 rounded-lg p-4 text-center">
                                <div className="text-sm text-orange-400">üí∏ Quedan</div>
                                <div className="text-2xl font-bold text-orange-400">{budget.toLocaleString()}‚Ç¨</div>
                                <div className="text-xs text-gray-400">{progBudget.toFixed(0)}%</div>
                            </div>
                            <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4 text-center cursor-pointer" onClick={() => setShowLogros(!showLogros)}>
                                <div className="text-sm text-yellow-400">üèÜ Logros</div>
                                <div className="text-2xl font-bold text-yellow-400">{logros.length}/3</div>
                            </div>
                        </div>
                        
                        {showLogros && (
                            <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-6 mb-6 animate-slide-in">
                                <h3 className="text-lg font-bold text-yellow-400 mb-4">üèÜ Logros Din√°micos</h3>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className={`p-4 rounded-lg ${logros.includes('25k') ? 'bg-yellow-500/20' : 'bg-black/30'}`}>
                                        <div className="text-3xl">{logros.includes('25k') ? 'üèÜ' : 'üîí'}</div>
                                        <div className="font-bold">25.000‚Ç¨</div>
                                        <div className="text-xs text-gray-400">{logros.includes('25k') ? '¬°Desbloqueado!' : `Faltan ${(25000-data.totalIngresos).toLocaleString()}‚Ç¨`}</div>
                                    </div>
                                    <div className={`p-4 rounded-lg ${logros.includes('50k') ? 'bg-cyan-500/20' : 'bg-black/30'}`}>
                                        <div className="text-3xl">{logros.includes('50k') ? 'üíé' : 'üîí'}</div>
                                        <div className="font-bold">50.000‚Ç¨</div>
                                        <div className="text-xs text-gray-400">{logros.includes('50k') ? '¬°Desbloqueado!' : data.totalIngresos >= 25000 ? `Faltan ${(50000-data.totalIngresos).toLocaleString()}‚Ç¨` : 'Desbloquea 25K'}</div>
                                    </div>
                                    <div className={`p-4 rounded-lg ${logros.includes('75k') ? 'bg-purple-500/20' : 'bg-black/30'}`}>
                                        <div className="text-3xl">{logros.includes('75k') ? 'üëë' : 'üîí'}</div>
                                        <div className="font-bold">75.000‚Ç¨</div>
                                        <div className="text-xs text-gray-400">{logros.includes('75k') ? '¬°Desbloqueado!' : data.totalIngresos >= 50000 ? `Faltan ${(75000-data.totalIngresos).toLocaleString()}‚Ç¨` : 'Desbloquea 50K'}</div>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <div className={`bg-gradient-to-br ${LOCATIONS[data.currentLocation].color} p-1 rounded-xl mb-6 animate-pulse-glow`}>
                            <div className="bg-slate-900/90 rounded-lg p-6">
                                <div className="flex justify-between items-center mb-4">
                                    <div>
                                        <div className="text-sm text-gray-400">üìç Ahora en:</div>
                                        <div className="text-3xl font-bold">{LOCATIONS[data.currentLocation].icon} {LOCATIONS[data.currentLocation].name}</div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-sm text-gray-400">‚è±Ô∏è Hace</div>
                                        <div className="text-2xl font-bold text-cyan-400">{getTime()}</div>
                                    </div>
                                </div>
                                <div className="bg-black/30 rounded-lg p-3">
                                    <div className="text-sm text-gray-400">üí¨ Actividad:</div>
                                    <div className="text-lg font-semibold">{data.currentActivity}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="text-center text-sm text-gray-400 py-10">
                            <p>üî• Sincronizado en tiempo real</p>
                            <p className="text-xs mt-2">Sistema autom√°tico 23:00-07:00 Dubai</p>
                        </div>
                    </div>
                    
                    {showAdmin && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
                            <div className="bg-slate-900 border-2 border-cyan-500/50 rounded-xl max-w-lg w-full p-6">
                                <div className="flex justify-between mb-6">
                                    <h2 className="text-xl font-bold text-cyan-400">üéÆ Admin</h2>
                                    <button onClick={() => {setShowAdmin(false); setIsAuth(false);}} className="text-2xl">‚úï</button>
                                </div>
                                {!isAuth ? (
                                    <form onSubmit={e => {e.preventDefault(); pass === ADMIN_PASSWORD ? setIsAuth(true) : alert('Incorrecto');}}>
                                        <input type="password" value={pass} onChange={e => setPass(e.target.value)} className="w-full bg-black/50 border border-cyan-500/30 rounded px-3 py-2 text-white mb-4" placeholder="Contrase√±a"/>
                                        <button type="submit" className="w-full bg-cyan-500 hover:bg-cyan-400 px-4 py-3 rounded-lg font-semibold">Entrar</button>
                                    </form>
                                ) : (
                                    <div className="space-y-6 max-h-[70vh] overflow-y-auto">
                                        <div className="bg-purple-500/10 border border-purple-500/30 rounded-lg p-4">
                                            <h3 className="font-bold text-purple-400 mb-4">üìç Ubicaci√≥n</h3>
                                            <form onSubmit={e => {e.preventDefault(); update({currentLocation: actForm.location, currentActivity: actForm.activity || LOCATIONS[actForm.location].defaultActivity, locationChangedAt: new Date().toISOString()}); alert('‚úÖ Actualizado'); setActForm({location:'oficina', activity:''});}}>
                                                <select value={actForm.location} onChange={e => setActForm({...actForm, location: e.target.value})} className="w-full bg-black/50 border border-purple-500/30 rounded px-3 py-2 text-white mb-2">
                                                    {Object.values(LOCATIONS).map(l => <option key={l.id} value={l.id}>{l.name}</option>)}
                                                </select>
                                                <input type="text" value={actForm.activity} onChange={e => setActForm({...actForm, activity: e.target.value})} className="w-full bg-black/50 border border-purple-500/30 rounded px-3 py-2 text-white mb-2" placeholder="Actividad..." maxLength={100}/>
                                                <button type="submit" className="w-full bg-purple-500 hover:bg-purple-400 px-4 py-2 rounded font-semibold">Actualizar</button>
                                            </form>
                                        </div>
                                        <div className="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                            <h3 className="font-bold text-green-400 mb-4">üí∞ Finanzas</h3>
                                            <form onSubmit={e => {
                                                e.preventDefault();
                                                const m = parseFloat(finForm.monto);
                                                if(isNaN(m) || m <= 0) return alert('Monto inv√°lido');
                                                const act = {id: Date.now(), fecha: new Date().toISOString(), ...finForm, monto: m};
                                                let ti = data.totalIngresos, tg = data.totalGastos, ipc = {...data.ingresosPorCategoria};
                                                if(finForm.tipo === 'ingreso') { ti += m; ipc[finForm.categoria] += m; } else { tg += m; }
                                                update({totalIngresos: ti, totalGastos: tg, ingresosPorCategoria: ipc, actualizaciones: [act, ...data.actualizaciones]});
                                                setFinForm({categoria: 'asesoria', monto: '', tipo: 'ingreso', nota: ''});
                                                alert('‚úÖ Guardado');
                                            }}>
                                                <select value={finForm.tipo} onChange={e => setFinForm({...finForm, tipo: e.target.value})} className="w-full bg-black/50 border border-green-500/30 rounded px-3 py-2 text-white mb-2">
                                                    <option value="ingreso">üí∞ Ingreso</option>
                                                    <option value="gasto">üí∏ Gasto</option>
                                                </select>
                                                {finForm.tipo === 'ingreso' && (
                                                    <select value={finForm.categoria} onChange={e => setFinForm({...finForm, categoria: e.target.value})} className="w-full bg-black/50 border border-green-500/30 rounded px-3 py-2 text-white mb-2">
                                                        <option value="asesoria">üíº Asesoramiento</option>
                                                        <option value="realEstate">üè¢ Real Estate</option>
                                                        <option value="inversiones">üìä Inversiones</option>
                                                    </select>
                                                )}
                                                <input type="number" value={finForm.monto} onChange={e => setFinForm({...finForm, monto: e.target.value})} className="w-full bg-black/50 border border-green-500/30 rounded px-3 py-2 text-white mb-2" placeholder="Monto ‚Ç¨" step="0.01" required/>
                                                <textarea value={finForm.nota} onChange={e => setFinForm({...finForm, nota: e.target.value})} className="w-full bg-black/50 border border-green-500/30 rounded px-3 py-2 text-white mb-2" placeholder="Nota..." rows="2" maxLength={200}/>
                                                <button type="submit" className="w-full bg-green-500 hover:bg-green-400 px-4 py-2 rounded font-semibold">Guardar</button>
                                            </form>
                                        </div>
                                        <div className="bg-black/30 border border-cyan-500/30 rounded-lg p-4">
                                            <h3 className="text-sm font-semibold text-cyan-400 mb-2">üìä Resumen</h3>
                                            <div className="grid grid-cols-2 gap-2 text-sm">
                                                <div>Ingresos:</div><div className="text-green-400 font-semibold text-right">{data.totalIngresos.toLocaleString()}‚Ç¨</div>
                                                <div>Gastos:</div><div className="text-red-400 font-semibold text-right">{data.totalGastos.toLocaleString()}‚Ç¨</div>
                                                <div>Logros:</div><div className="text-yellow-400 font-semibold text-right">{logros.length}/3 üèÜ</div>
                                                <div>Visitantes:</div><div className="text-cyan-400 font-semibold text-right">{visitantes}</div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
